function Init2D(a){context=a.getContext("2d")}function InitBox2D(){world=new b2World(new b2Vec2(0,0),!0),world.SetContactListener(contactListener)}function Loop(){if(requestAnimFrame(Loop),mouseIsOverCanvas){var a=(new Date).getTime(),b=0;0!=prevTime&&(b=(a-prevTime)/1e3),prevTime=a,b>.1&&(b=0),tick(b),world.Step(b,8,3),world.ClearForces(),draw()}ResetInput()}function InitPlanetoids(a,b){canvas=a,numberOfRocks=b,Init2D(canvas),InitBox2D(),InitInput(),start(),mouseIsOverCanvas||draw(),Loop()}function CreateWalls(){var a=new b2FixtureDef;a.density=1,a.friction=0,a.restitution=1,a.shape=new b2PolygonShape;var b=new b2BodyDef;b.type=b2Body.b2_staticBody,b.position.x=canvas.width/2/SCALE,b.position.y=canvas.height/SCALE-1/SCALE,a.shape.SetAsBox(canvas.width/SCALE/2,10/SCALE/2),walls[0]=world.CreateBody(b),walls[0].CreateFixture(a),b.position.x=canvas.width/2/SCALE,b.position.y=1/SCALE,a.shape.SetAsBox(canvas.width/SCALE/2,10/SCALE/2),walls[1]=world.CreateBody(b),walls[1].CreateFixture(a),b.position.x=canvas.width/SCALE-1/SCALE,b.position.y=canvas.height/2/SCALE,a.shape.SetAsBox(10/SCALE/2,canvas.height/SCALE/2),walls[2]=world.CreateBody(b),walls[2].CreateFixture(a),b.position.x=1/SCALE,b.position.y=canvas.height/2/SCALE,a.shape.SetAsBox(10/SCALE/2,canvas.height/SCALE/2),walls[3]=world.CreateBody(b),walls[3].CreateFixture(a)}function DestroyCurrentWorld(){rocks.DestroyAll(),powerups.DestroyAll()}function StartNewRandomWorld(){DestroyCurrentWorld(),ship.Reset(),rocks.Create(numberOfRocks),powerups.Create(2),curPlayTime=0}function RestartGameWithDifferentCanvasSize(){world.DestroyBody(walls[0]),world.DestroyBody(walls[1]),world.DestroyBody(walls[2]),world.DestroyBody(walls[3]),CreateWalls(),stars=new Stars,stars.Init(100),StartNewRandomWorld(),draw()}function start(){CreateWalls(),stars=new Stars,stars.Init(100),ship=new SpaceShip,ship.Init(),lasers=new Lasers,powerups=new Powerups,rocks=new Rocks,StartNewRandomWorld()}function tick(a){curPlayTime+=a,ship.Tick(a),lasers.Tick(a),rocks.Tick(a),powerups.Tick(a),ship.IsAlive()||StartNewRandomWorld(),rocks.AllDestroyed()&&(null!=bestTime?bestTime>curPlayTime&&(bestTime=curPlayTime):bestTime=curPlayTime,StartNewRandomWorld())}function draw(){context.fillStyle="rgb(4, 15, 22)",context.fillRect(0,0,canvas.width,canvas.height),stars.Draw(),lasers.Draw(),ship.Draw(),rocks.Draw(),powerups.Draw(),context.fillStyle="rgb(180, 180, 180)",context.font="bold 14px sans-serif",context.fillText("Time: "+TimeToString(curPlayTime),10,canvas.height-10),bestTime&&context.fillText("Best: "+TimeToString(bestTime),100,canvas.height-10),context.fillText("Hold right to move. Click left to shoot.",canvas.width-275,canvas.height-10)}function ResetTransform(){context.setTransform(1,0,0,1,0,0)}function LerpToHex(a,b,c,d){var e=Math.round(a[0]*(1-c)+b[0]*c),f=Math.round(a[1]*(1-c)+b[1]*c),g=Math.round(a[2]*(1-c)+b[2]*c);return"rgba("+e+","+f+","+g+","+d+")"}function ToHexColor(a,b,c,d){return"rgba("+a+","+c+","+b+","+d+")"}function GetElementPosition(){DetectBrowser();var b,c;return"Chrome"==browserName?(b=0,c=0):(b=canvas.offsetLeft,c=canvas.offsetTop),{x:b,y:c}}function DegToRad(a){return a*Math.PI/180}function DetectBrowser(){-1!=(verOffset=nAgt.indexOf("Opera"))?(browserName="Opera",fullVersion=nAgt.substring(verOffset+6),-1!=(verOffset=nAgt.indexOf("Version"))&&(fullVersion=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("MSIE"))?(browserName="Microsoft Internet Explorer",fullVersion=nAgt.substring(verOffset+5)):-1!=(verOffset=nAgt.indexOf("Chrome"))?(browserName="Chrome",fullVersion=nAgt.substring(verOffset+7)):-1!=(verOffset=nAgt.indexOf("Safari"))?(browserName="Safari",fullVersion=nAgt.substring(verOffset+7),-1!=(verOffset=nAgt.indexOf("Version"))&&(fullVersion=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("Firefox"))?(browserName="Firefox",fullVersion=nAgt.substring(verOffset+8)):(nameOffset=nAgt.lastIndexOf(" ")+1)<(verOffset=nAgt.lastIndexOf("/"))&&(browserName=nAgt.substring(nameOffset,verOffset),fullVersion=nAgt.substring(verOffset+1),browserName.toLowerCase()==browserName.toUpperCase()&&(browserName=navigator.appName)),-1!=(ix=fullVersion.indexOf(";"))&&(fullVersion=fullVersion.substring(0,ix)),-1!=(ix=fullVersion.indexOf(" "))&&(fullVersion=fullVersion.substring(0,ix)),majorVersion=parseInt(""+fullVersion,10),isNaN(majorVersion)&&(fullVersion=""+parseFloat(navigator.appVersion),majorVersion=parseInt(navigator.appVersion,10))}function DeTransformVector(a,b,c,d){var e=new b2Mat22;e.Set(-d);var f=new b2Vec2(a.x,a.y);return f.x-=b.x,f.y-=b.y,f.MulM(e),f.x/=c,f.y/=c,f}function TimeToString(a){var b=Math.floor(a/60),c=Math.round(a-60*b);return 10>b&&(b="0"+b),10>c&&(c="0"+c),b+":"+c}function RandomStartPos(){var a=new b2Vec2;a.x=20+Math.random()*(canvas.width-40),a.y=20+Math.random()*(canvas.height-40);var b=100,c=a.Copy();return c.Subtract(new b2Vec2(canvas.width/2,canvas.height/2)),c.LengthSquared()<=b*b&&(c.Normalize(),c.Multiply(b),a.Add(c)),a}function Distance(a,b,c,d){var e=0,f=0;return e=c-a,e*=e,f=d-b,f*=f,Math.sqrt(e+f)}function SpaceShip(){this.speed=12,this.size=15,this.body,this.health=MAX_HEALTH,this.shieldStrength=2,this.powerTime=0,this.dir=new b2Vec2(0,0),this.dragging=!1,this.CurrentWeaponMethod=DefaultWeaponMethod}function DefaultWeaponMethod(a){var b=ship.body.GetPosition().Copy(),c=a.Copy();c.Multiply(1e3),c.Add(b),lasers.AddLaser(b,c,5)}function Lasers(){this.lasers=[]}function Laser(a,b,c){this.startPos=new b2Vec2(a.x*SCALE,a.y*SCALE),this.endPos=new b2Vec2(b.x*SCALE,b.y*SCALE),this.life=MAX_LASER_LIFE,rocks.Slice(a,b,c)}function Rocks(){this.rocks=[]}function Rock(){this.body,this.isDying=!1,this.fading=FADETIME,this.vertexPosBuffer,this.vertexColBuffer,this.physVertices}function Powerups(){this.powerups=[]}function Powerup(a,b){this.body,this.isDead=!1,this.weaponMethod=b,this.Init(a)}function TripleLaserWeaponMethod(a){var b=ship.body.GetPosition().Copy(),c=a.Copy();c.Multiply(1e3),c.Add(b);var d=new b2Vec2(-a.y,a.x);d.Multiply(10.5/SCALE),lasers.AddLaser(b,c,2.5),b.Add(d),c.Add(d),lasers.AddLaser(b,c,2.5),d.Multiply(-2),b.Add(d),c.Add(d),lasers.AddLaser(b,c,2.5)}function Star(){this.pos=new b2Vec2(Math.random()*canvas.width,Math.random()*canvas.height),this.size=MIN_STAR_SIZE+Math.random()*(MAX_STAR_SIZE-MIN_STAR_SIZE)}function Stars(){this.stars=[]}function SlicePoint(a,b){this.Position=a,this.Side=b}function InitInput(){canvasPosition=GetElementPosition(canvas),InitMouse(),InitTouch()}function ResetInput(){ResetMouse(),ResetTouch()}function InitMouse(){canvas.addEventListener("mousedown",function(a){1==a.which?(leftMouseDown=!0,leftMouseClick=!0):3==a.which&&(rightMouseDown=!0,rightMouseClick=!0),a.preventDefault()},!0),canvas.addEventListener("mouseup",function(a){1==a.which?leftMouseDown=!1:3==a.which&&(rightMouseDown=!1),a.preventDefault()},!0),canvas.addEventListener("mousemove",function(a){mouseX=a.layerX-canvasPosition.x,mouseY=a.layerY-canvasPosition.y,a.preventDefault()},!0),canvas.addEventListener("mouseover",function(a){mouseIsOverCanvas=!0,console.log("in"),a.preventDefault()},!0),canvas.addEventListener("mouseout",function(a){mouseIsOverCanvas=!1,console.log("out"),a.preventDefault()},!0)}function ResetMouse(){leftMouseClick=!1,rightMouseClick=!1}function InitTouch(){function a(a){touchEnd=!0,touching=!1,a.preventDefault()}canvas.addEventListener("touchstart",function(a){if(a.touches.length>0){touchStart=!0,touching=!0;var b=a.touches[0];touchX=b.pageX-canvasPosition.x,touchY=b.pageY-canvasPosition.y,touchMoveAlphaX=0,touchMoveAlphaY=0}a.preventDefault()},!0),canvas.addEventListener("touchmove",function(a){if(a.touches.length>0){touchMove=!0;var b=a.touches[0],c=b.pageX-canvasPosition.x,d=b.pageY-canvasPosition.y;touchMoveAlphaX=c-touchX,touchMoveAlphaY=d-touchY,touchX=c,touchY=d}a.preventDefault()},!0),canvas.addEventListener("touchend",a,!0),canvas.addEventListener("touchcancel",a,!0)}function ResetTouch(){touchStart=!1,touchEnd=!1,touchMove=!1}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();var SCALE=30,context,b2Vec2=Box2D.Common.Math.b2Vec2,b2Vec3=Box2D.Common.Math.b2Vec3,b2BodyDef=Box2D.Dynamics.b2BodyDef,b2Body=Box2D.Dynamics.b2Body,b2FixtureDef=Box2D.Dynamics.b2FixtureDef,b2Fixture=Box2D.Dynamics.b2Fixture,b2World=Box2D.Dynamics.b2World,b2MassData=Box2D.Collision.Shapes.b2MassData,b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape,b2CircleShape=Box2D.Collision.Shapes.b2CircleShape,b2DebugDraw=Box2D.Dynamics.b2DebugDraw,b2Transform=Box2D.Common.Math.b2Transform,b2Mat22=Box2D.Common.Math.b2Mat22,b2ContactListener=Box2D.Dynamics.b2ContactListener,world,debugDraw,contactListener=new b2ContactListener,prevTime=0,canvas,ship,lasers,powerups,numberOfRocks=10,rocks,stars,walls=[],curPlayTime,bestTime;contactListener.PostSolve=function(a,b){var c=0,d=null;a.GetFixtureA().GetBody()==ship.GetBody()?d=a.GetFixtureB().GetBody().GetUserData():a.GetFixtureB().GetBody()==ship.GetBody()&&(d=a.GetFixtureA().GetBody().GetUserData()),null!=d&&(d.GetType()==ROCKID?(c=b.normalImpulses[0]*d.DeathPercentage(),ship.Damage(c*c)):d.GetType()==POWERUPTYPE&&d.PickUp())};var nVer=navigator.appVersion,nAgt=navigator.userAgent,browserName=navigator.appName,fullVersion=""+parseFloat(navigator.appVersion),majorVersion=parseInt(navigator.appVersion,10),nameOffset,verOffset,ix,SPACESHIP_COLOR="rgb(32, 63, 82)",FULL_HEALTH_COLOR=[136,166,27],LOW_HEALTH_COLOR=[242,92,5],MAX_HEALTH=300;SpaceShip.prototype={Init:function(){var a=new b2BodyDef;a.type=b2Body.b2_dynamicBody,a.position.x=canvas.width/2/SCALE,a.position.y=canvas.height/2/SCALE;var b=new b2FixtureDef;b.density=1,b.restitution=0,b.shape=new b2CircleShape,b.shape.m_radius=this.size/SCALE,this.body=world.CreateBody(a),this.body.CreateFixture(b),this.body.SetLinearDamping(1),this.body.SetFixedRotation(!0),this.body.SetSleepingAllowed(!1)},Tick:function(a){if(this.laserLife-=a,this.powerTime-=a,rightMouseDown){var b=new b2Vec2(mouseX/SCALE-this.body.GetPosition().x,mouseY/SCALE-this.body.GetPosition().y);b.Normalize(),b.Multiply(this.speed),this.body.ApplyForce(b,this.body.GetPosition())}if(leftMouseClick){var b=new b2Vec2(mouseX/SCALE-this.body.GetPosition().x,mouseY/SCALE-this.body.GetPosition().y);b.Normalize(),this.CurrentWeaponMethod(b)}if(touching){var c=new b2Vec2(touchX/SCALE,touchY/SCALE),d=Distance(c.x,c.y,this.body.GetPosition().x,this.body.GetPosition().y)*SCALE;if(d>3*this.size){var b=new b2Vec2(touchX-this.body.GetPosition().x*SCALE,touchY-this.body.GetPosition().y*SCALE);b.Normalize(),this.CurrentWeaponMethod(b)}else this.dragging=!0}if(this.dragging){var c=new b2Vec2(touchX,touchY);c.x=Math.max(c.x,this.size),c.y=Math.max(c.y,this.size),c.x=Math.min(c.x,canvas.width-this.size),c.y=Math.min(c.y,canvas.height-this.size),c.x/=SCALE,c.y/=SCALE,this.body.SetLinearVelocity(new b2Vec2(touchMoveAlphaX,touchMoveAlphaY)),this.body.SetPosition(c)}touchEnd&&this.dragging&&(this.dragging=!1,this.body.SetLinearVelocity(new b2Vec2(touchMoveAlphaX,touchMoveAlphaY))),this.powerTime<0&&(this.CurrentWeaponMethod=DefaultWeaponMethod)},Draw:function(){var a=this.body.GetPosition().x*SCALE,b=this.body.GetPosition().y*SCALE,c=this.size/5;if(-1!=mouseX||-1!=mouseY)var d=Math.atan2(mouseY-b,mouseX-a);if(-1!=touchX||-1!=touchY)var d=Math.atan2(touchY-b,touchX-a);context.translate(a,b),context.rotate(d),context.beginPath(),context.arc(0,0,this.size,0,2*Math.PI,!1),context.fillStyle=LerpToHex(LOW_HEALTH_COLOR,FULL_HEALTH_COLOR,this.health/MAX_HEALTH,.2),context.fill(),context.lineWidth=1.5,context.strokeStyle=LerpToHex(LOW_HEALTH_COLOR,FULL_HEALTH_COLOR,this.health/MAX_HEALTH,1),context.stroke(),context.beginPath(),context.moveTo(0,0),context.lineTo(-1*c,-1*c),context.lineTo(0,-3*c),context.lineTo(2*c,-3*c),context.lineTo(-1*c,-4*c),context.lineTo(-2*c,0),context.lineTo(-1*c,4*c),context.lineTo(2*c,3*c),context.lineTo(0,3*c),context.lineTo(-1*c,1*c),context.closePath(),context.fillStyle=SPACESHIP_COLOR,context.fill(),ResetTransform()},Reset:function(){this.body.SetPosition(new b2Vec2(canvas.width/2/SCALE,canvas.height/2/SCALE)),this.body.SetLinearVelocity(new b2Vec2(0,0)),this.health=MAX_HEALTH,this.powerTime=0},GetBody:function(){return this.body},Damage:function(a){this.health-=a/this.shieldStrength},IsAlive:function(){return this.health>0},SetPowerup:function(a,b){this.CurrentWeaponMethod=a,this.powerTime=b}};var MAX_LASER_LIFE=.5,LASER_WIDTH=4,LASER_COLOR="rgb(217, 37, 37)";Lasers.prototype={AddLaser:function(a,b,c){this.lasers.push(new Laser(a,b,c))},Draw:function(){for(var a=0;a<this.lasers.length;a++)this.lasers[a].Draw()},Tick:function(a){for(var b=0;b<this.lasers.length;b++)this.lasers[b].Tick(a);for(var b=0;b<this.lasers.length;b++)this.lasers[b].IsDead()&&(this.lasers.splice(b,1),b--)}},Laser.prototype={Draw:function(){context.beginPath(),context.moveTo(this.startPos.x,this.startPos.y),context.lineTo(this.endPos.x,this.endPos.y),context.strokeStyle=ToHexColor(217,37,37,this.LifePercentage()),context.lineWidth=LASER_WIDTH*this.LifePercentage(),context.stroke()},Tick:function(a){this.life-=a},IsDead:function(){return this.life<0?!0:!1},LifePercentage:function(){return this.life/MAX_LASER_LIFE}};var ROCKID=-1,ROCKSIZE=50,STARTNUMPOINTS=5,FADETIME=1,DEATHAREA=.5,MINAREA=.01,ROCKCOLOR="rgb(240, 236, 225)";Rocks.prototype={Create:function(a){for(var b=0;a>b;++b)this.NewRandomRock()},Add:function(a){this.rocks.push(a)},Tick:function(a){for(var b=0;b<this.rocks.length;b++)this.rocks[b].Tick(a);for(var b=0;b<this.rocks.length;b++)if(this.rocks[b].IsDead()){var c=this.rocks[b].GetBody();world.DestroyBody(c),this.rocks.splice(b,1),b--}},Draw:function(){for(var a=0;a<this.rocks.length;a++)this.rocks[a].Draw()},Slice:function(a,b,c){for(var d=this.rocks.length,e=0;d>e;e++)this.rocks[e].Slice(a,b,c)},NewRandomRock:function(){var a=new Rock,b=RandomStartPos();a.InitRand(b),this.rocks.push(a)},DestroyOne:function(a){var b=this.rocks[a].GetBody();world.DestroyBody(b),this.rocks.splice(a,1)},DestroyAll:function(){for(var a=0;a<this.rocks.length;a++){var b=this.rocks[a].GetBody();world.DestroyBody(b)}this.rocks=[]},AllDestroyed:function(){return this.rocks.length<=0?!0:!1}},Rock.prototype={InitRand:function(a){return this.CreateBodyRand(a,0)?!0:!1},Init:function(a,b,c){if(!this.CreateBody(a,c,b))return!1;var d=this.GetArea(b);return DEATHAREA>=d&&(this.isDying=!0),!0},CreateBody:function(a,b,c){try{var d=new b2BodyDef;if(d.type=b2Body.b2_dynamicBody,d.position.x=a.x/SCALE,d.position.y=a.y/SCALE,this.physVertices=c,!this.IsValid(this.physVertices))return!1;var e=new b2FixtureDef;e.shape=new b2PolygonShape,e.shape.SetAsArray(c,c.length),e.density=1,e.restitution=1,e.friction=0,this.body=world.CreateBody(d),this.body.CreateFixture(e),this.body.SetLinearDamping(0),this.body.SetAngularDamping(.2);var f=this.body.GetPosition();this.body.SetPositionAndAngle(f,b),this.body.SetUserData(this)}catch(g){return console.log("Creating rock body failed with folowing error: "+g.description),!1}return!0},CreateBodyRand:function(a,b){try{var c=new b2BodyDef;c.type=b2Body.b2_dynamicBody,c.position.x=a.x/SCALE,c.position.y=a.y/SCALE;for(var d=[],e=0;STARTNUMPOINTS>e;++e){var f=2*(Math.PI/STARTNUMPOINTS)*e;f-=Math.PI/STARTNUMPOINTS,f+=2*(Math.PI/STARTNUMPOINTS)*Math.random(),d.push(new b2Vec2(Math.cos(f)*ROCKSIZE/SCALE,Math.sin(f)*ROCKSIZE/SCALE))}if(this.physVertices=d,!this.IsValid(this.physVertices))return!1;var g=new b2FixtureDef;g.shape=new b2PolygonShape,g.shape.SetAsArray(d,d.length),g.density=1,g.restitution=1,g.friction=0,this.body=world.CreateBody(c),this.body.CreateFixture(g),this.body.SetLinearDamping(0),this.body.SetAngularDamping(.2);var h=this.body.GetPosition();this.body.SetPositionAndAngle(h,b),this.body.SetUserData(this)}catch(i){return console.log("Creating rock body failed with folowing error: "+i.description),!1}return!0},IsValid:function(a){var b=this.GetArea(a);return b>=MINAREA?!0:(console.log("Rock is too small ("+b+"), limiting this for efficiency reasons."),!1)},Tick:function(a){this.isDying&&(this.fading-=a)},Draw:function(){context.beginPath();var a=this.body.GetPosition();context.translate(a.x*SCALE,a.y*SCALE),context.rotate(this.body.GetAngle()),context.moveTo(this.physVertices[0].x*SCALE,this.physVertices[0].y*SCALE);for(var b=1;b<this.physVertices.length;b++)context.lineTo(this.physVertices[b].x*SCALE,this.physVertices[b].y*SCALE);context.closePath(),context.globalAlpha=this.fading/FADETIME,context.fillStyle=ROCKCOLOR,context.fill(),context.globalAlpha=1,ResetTransform()},Slice:function(a,b,c){if(this.isDying&&this.fading<FADETIME)return!1;var d=this.body;this.vertexPosBuffer,this.vertexColBuffer;var g=this.physVertices;a=DeTransformVector(a,d.GetPosition(),1,d.GetAngle()),b=DeTransformVector(b,d.GetPosition(),1,d.GetAngle());for(var h=[],i=0;i<g.length;++i){var j=new b2Vec2,k=a.x,l=b.x,m=g[i].x,n=g[(i+1)%g.length].x,o=a.y,p=b.y,q=g[i].y,r=g[(i+1)%g.length].y;j.x=((k*p-o*l)*(m-n)-(k-l)*(m*r-q*n))/((k-l)*(q-r)-(o-p)*(m-n)),j.y=((k*p-o*l)*(q-r)-(o-p)*(m*r-q*n))/((k-l)*(q-r)-(o-p)*(m-n));var s=Math.min(g[i].x,g[(i+1)%g.length].x),t=Math.max(g[i].x,g[(i+1)%g.length].x),u=Math.min(g[i].y,g[(i+1)%g.length].y),v=Math.max(g[i].y,g[(i+1)%g.length].y),w=Math.min(a.x,b.x),x=Math.max(a.x,b.x),y=Math.min(a.y,b.y),z=Math.max(a.y,b.y);if(j.x>=s&&j.x<t&&j.y>=u&&j.y<v&&j.x>=w&&j.x<x&&j.y>=y&&j.y<z){var A=new SlicePoint(j,i);h.push(A)}}if(h.length>2)return console.log("Something wrong with the slicing, "+h.length+" hit(s) found. Should never happen, please report this."),!1;if(2==h.length){for(var B=Math.abs(h[0].Side-h[1].Side),C=g.length-B,D=[],E=[],F=h[0].Side+1,i=0;B>i;++i)F>=g.length&&console.log("Whoops, something wrong with the slicing. Should never happen, please report this."),D.push(g[F]),++F;D.push(h[1].Position),D.push(h[0].Position);for(var i=0;C>i;++i)F%=g.length,E.push(g[F]),++F;if(E.push(h[0].Position),E.push(h[1].Position),!this.IsValid(D)||!this.IsValid(E))return!1;var G=new b2Vec2(d.GetPosition().x*SCALE,d.GetPosition().y*SCALE),H=d.GetAngle(),I=new b2Vec2(d.GetLinearVelocity().x,d.GetLinearVelocity().y),J=d.GetAngularVelocity(),K=new b2Vec2(b.x-a.x,b.y-a.y),L=new b2Vec2(-K.y,K.x);L.Normalize(),L.Multiply(c),world.DestroyBody(d),this.Init(G,D,H);var M=new Rock;if(!M.Init(G,E,H))return!1;var N=new b2Vec2;N.Set(I.x+L.x,I.y+L.y),this.body.SetLinearVelocity(I),this.body.SetAngularVelocity(J),this.body.ApplyImpulse(L,this.body.GetWorldCenter()),N.Set(I.x-L.x,I.y-L.y);var O=M.GetBody();return O.SetLinearVelocity(I),O.SetAngularVelocity(J),O.ApplyImpulse(L.GetNegative(),O.GetWorldCenter()),rocks.Add(M),!0}},GetArea:function(a){for(var b=0,c=0;c<a.length;++c){var d=new b2Vec2,e=new b2Vec2;d.x=a[c].x,d.y=a[c].y,e.x=a[(c+1)%a.length].x,e.y=a[(c+1)%a.length].y,b+=d.x*e.y-e.x*d.y}return b/=2,b=Math.abs(b)},IsDead:function(){return this.isDying&&this.fading<=0},DeathPercentage:function(){return this.fading/FADETIME},GetBody:function(){return this.body},GetType:function(){return ROCKID}};var POWERUPSIZE=10,POWERUPTYPE=0,tripleLaserVertexPosBuffer,tripleLaserVertexColBuffer,TRIPLELASERCOLOR="rgb(100, 100, 225)";Powerups.prototype={Tick:function(){for(var b=0;b<this.powerups.length;b++)if(this.powerups[b].IsDead()){var c=this.powerups[b].GetBody();world.DestroyBody(c),this.powerups.splice(b,1),b--}},Create:function(a){for(var b=0;a>b;++b)this.NewRandomPowerup()},NewRandomPowerup:function(){var a=RandomStartPos(),b=new Powerup(a,TripleLaserWeaponMethod);this.powerups.push(b)},DestroyOne:function(a){var b=this.powerups[a].GetBody();world.DestroyBody(b),this.powerups.splice(a,1)},DestroyAll:function(){for(var a=0;a<this.powerups.length;a++){var b=this.powerups[a].GetBody();world.DestroyBody(b)}this.powerups=[]},Draw:function(){for(var a=0;a<this.powerups.length;a++)this.powerups[a].Draw()}},Powerup.prototype={Init:function(a){var b=new b2BodyDef;b.type=b2Body.b2_dynamicBody,b.position.x=a.x/SCALE,b.position.y=a.y/SCALE;var c=new b2FixtureDef;c.density=1,c.restitution=0,c.shape=new b2CircleShape,c.shape.m_radius=POWERUPSIZE/SCALE,this.body=world.CreateBody(b),this.body.CreateFixture(c),this.body.SetLinearDamping(1),this.body.SetFixedRotation(!0),this.body.SetUserData(this)},Draw:function(){var a=this.body.GetPosition();context.beginPath(),context.arc(a.x*SCALE,a.y*SCALE,POWERUPSIZE,0,2*Math.PI,!1),context.fillStyle=TRIPLELASERCOLOR,context.fill()},IsDead:function(){return this.isDead},GetBody:function(){return this.body},GetWeaponMethod:function(){return this.weaponMethod},PickUp:function(){ship.SetPowerup(this.GetWeaponMethod(),5),this.isDead=!0},GetType:function(){return POWERUPTYPE}};var MIN_STAR_SIZE=.3,MAX_STAR_SIZE=1;Star.prototype={Draw:function(){context.beginPath(),context.arc(this.pos.x,this.pos.y,this.size,0,2*Math.PI,!1),context.fillStyle="#FFFFFF",context.fill()}},Stars.prototype={Init:function(a){for(var b=0;a>b;b++)this.stars.push(new Star)},Draw:function(){for(var a=0;a<this.stars.length;a++)this.stars[a].Draw()}};var canvasPosition,mouseX=-1,mouseY=-1,leftMouseDown=!1,rightMouseDown=!1,leftMouseClick=!1,rightMouseClick=!1,mouseIsOverCanvas=!1,touchX=-1,touchY=-1,touchStart=!1,touchEnd=!1,touchMove=!1,touching=!1,touchMoveAlphaX=0,touchMoveAlphaY=0;